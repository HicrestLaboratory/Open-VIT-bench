import torch

from timm.models.vision_transformer import VisionTransformer
from cvit_utils import tensor_2d_to_prediction_batch
from cvit_utils import store_cvit, store_cpic, store_cprd

print("Creating test_files")

vit_1 = VisionTransformer(
    12, 4, 3, 10, 'token', 8, 5, 2, 0.667, True, True, 0.00020, True, 'learn',
    False, 2, True, True, False, False, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '', False)
store_cvit(vit_1, '../test_files/test_vit_1.cvit')

vit_2 = VisionTransformer(
    12, 4, 3, 14, 'avgmax', 15, 14, 5, 4.2, True, False, 0.00005, True, 'learn',
    True, 7, False, False, False, False, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '', False)
store_cvit(vit_2, '../test_files/test_vit_2.cvit')

vit_3 = VisionTransformer(
    12, 2, 3, 5, 'max', 28, 2, 4, 2.0, False, True, 0.00300, True, 'learn',
    False, 19, True, True, False, False, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '', False)
store_cvit(vit_3, '../test_files/test_vit_3.cvit')

test_utils_vit = VisionTransformer(
    12, 4, 3, 10, 'token', 8, 5, 2, 0.667, True, True, 0.0002, True, 'learn',
    False, 2, True, True, False, False, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, '', False)
store_cvit(test_utils_vit, '../test_files/test_utils.cvit')

pic = torch.tensor([[[[-16.490, -70.189,   9.305,  98.138,  32.944],
                      [  1.718,   9.212,  99.872, -25.441,  83.307],
                      [ 33.161, -76.944,  98.541,  57.598,  69.029],
                      [-62.406,  75.247, -45.673,  77.095, -95.404],
                      [-67.207, -28.887,  58.128,  65.152, -53.576],
                      [ -5.310,   5.363,  40.465,  -8.256, -55.741],
                      [ 55.514,  78.386, -48.312,  54.607,  42.520]],

                     [[-66.192, -59.102,  86.644,  17.829,  62.739],
                      [ 36.882,  59.757, -67.076,  88.401, -50.592],
                      [ 52.676,  -1.825,  -0.399, -44.452, -15.317],
                      [ 49.402, -21.328, -27.570,  70.459, -31.566],
                      [ 33.117,   9.037, -97.926,  40.803,  40.198],
                      [-37.858,   0.680,  59.761,   4.253, -50.526],
                      [ 57.677, -57.860,  65.320, -32.631, -59.442]],

                     [[-25.880,  -8.632,  92.048,  56.873,  12.952],
                      [ 55.963,  -5.699,  76.976, -81.913, -67.561],
                      [ 12.442, -15.839,  55.217,  42.063,  68.408],
                      [  1.330,  27.669,   1.119, -31.311,   6.863],
                      [ 87.071,  88.041,  26.239,  13.268,  75.431],
                      [ 27.219, -43.230,  91.684,  88.485,  12.635],
                      [-89.221, -56.780,  -7.420,  18.736, -96.304]],

                     [[-45.461,  57.595,  69.099,  54.328,  97.828],
                      [-64.511,  82.831, -89.469,  75.536, -40.211],
                      [-87.551,  90.365,  -6.445, -21.764, -80.928],
                      [-28.946, -24.975,  12.218, -61.405,  41.079],
                      [ 35.112,  20.521, -63.551,  65.554, -84.087],
                      [-14.871,  34.948,  75.372, -18.791,  16.620],
                      [-11.283, -74.018, -69.888, -23.583, -20.143]]],



                    [[[ 82.024, -82.093, -57.244, -59.820,  94.609],
                      [ 98.967,  12.044,  78.649,  54.768,  61.967],
                      [-61.915,  45.298,  79.693,  71.485,  29.089],
                      [ 44.213, -14.011, -15.260,  90.380,  51.613],
                      [ 56.260,  34.904,   0.172,  15.959, -86.665],
                      [-78.344,   9.652, -50.970, -68.973, -69.088],
                      [ 99.140,  -7.537,  51.096, -94.131,  49.254]],

                     [[-68.020, -55.017, -84.545,  46.969,  -1.983],
                      [-57.689, -24.494,  68.399, -88.965,  81.734],
                      [ 61.008,  24.439,  -7.430, -49.915, -58.170],
                      [-12.889,  31.833, -45.312,  38.226, -13.890],
                      [  5.664, -80.670,  66.222, -64.385,  72.835],
                      [ 99.758, -94.870,  53.543, -65.120,  59.630],
                      [-38.333,  -0.987,   9.625, -43.608, -70.738]],

                     [[-46.625,  97.489, -21.548,  56.492,  -7.392],
                      [ 55.723,  48.919,   5.219,  16.395, -29.096],
                      [ -5.844,  12.274, -81.487, -11.457,  -2.268],
                      [-17.614,  42.422, -75.631,  88.021,  34.744],
                      [ 30.298,  89.873,  -1.759,  62.559, -71.652],
                      [ 95.692,  73.999, -23.386, -11.260, -70.231],
                      [ 60.877,  82.170, -49.702,  -4.636, -27.618]],

                     [[ 30.186, -14.140,  40.026,  36.480, -51.018],
                      [ 57.484,  73.572, -67.906, -15.700,  22.368],
                      [-66.291,  57.587, -55.733, -67.937,  24.736],
                      [-61.329, -95.893, -48.001, -52.496,  42.202],
                      [ -1.209,  16.367,  45.174,   8.936,  65.025],
                      [ 76.292, -77.237, -29.031, -62.556,  49.121],
                      [ 26.325,  -8.381, -79.123, -45.326,  76.213]]],



                    [[[-34.879,  96.367, -30.731, -43.420,  43.659],
                      [ 51.225,  61.874,  27.927, -24.671, -71.727],
                      [-73.750,  56.087,  80.216, -98.056,  34.516],
                      [ 29.523, -64.989,  38.732,  43.375, -56.563],
                      [ 82.777,  73.635, -70.993, -49.700, -31.306],
                      [ 83.957, -30.308, -44.215, -79.741,  22.798],
                      [ 59.506,   4.287,  97.786,  88.388,  59.702]],

                     [[ -0.031, -62.375, -11.147, -74.444,  65.734],
                      [ 66.545, -88.643,  56.584,  17.695,  94.490],
                      [ 24.235,  65.041,  11.155, -69.196,  16.958],
                      [ 15.525,  -1.353,  33.392, -43.894, -91.901],
                      [-60.437,  24.284, -12.779,  46.338,   5.421],
                      [ 84.374,  88.605,  26.411, -16.484,  26.434],
                      [ 35.796,   6.073, -28.815,  -3.590,  44.199]],

                     [[-64.009,  53.175,  38.367, -40.289, -10.594],
                      [ 74.175,  47.984,   8.232, -65.889,   3.737],
                      [-61.400,  56.870, -98.981,  26.620,  46.279],
                      [ 35.904,  30.785, -11.512,  30.875, -87.513],
                      [ 24.820,  31.507,  31.263,  -7.233,  20.300],
                      [-83.957, -78.009, -63.515, -36.659,   1.024],
                      [ 80.352,  16.620, -68.825, -11.109, -99.962]],

                     [[-24.331,  74.500,  96.368,  51.120,  36.843],
                      [-86.295, -74.571,  73.286,  98.878,  57.220],
                      [  7.492, -97.854,   7.016, -57.655,  -2.587],
                      [-40.378,  64.240,  98.863,  56.633, -60.711],
                      [ 82.480, -59.864,  72.913, -40.060,  15.252],
                      [-22.952,  93.690, -63.442,  73.124, -62.109],
                      [ 68.374, -61.009, -12.876, -39.967,  95.535]]]])
store_cpic(pic, '../test_files/test_utils.cpic')

prd = torch.tensor([[-88.741, -76.771,  28.902,  93.451,  42.343,  19.532,  -4.622,  58.300, -35.822, -59.242,  52.257],
                     [ 28.453,  -0.612, -73.174, -19.000, -87.664,  42.057, -73.525,  33.125, -94.946,  17.710, -58.246],
                     [ 40.843,  68.356,  24.866, -43.293,  18.536,  -5.775, -73.697, -19.646,  81.056,  75.415, -91.977],
                     [ 10.653,  26.936,   4.173,  10.469,  95.819, -46.789,  85.391,   4.946, -94.298,   8.011, -87.464],
                     [-27.684, -86.358,  45.048, -32.347, -31.243,   5.053,  97.126,  96.367, -12.880,  57.608, -72.259],
                     [ 36.496, -80.831,  32.733,   5.613, -44.819, -28.605,  53.101,  68.866, -30.153,  42.465, -71.598],
                     [ 78.346, -32.045,  34.283, -80.646, -10.496, -19.136,  51.279,  -6.910,   6.436, -35.795, -99.901],
                     [ 68.572, -15.187,  29.248,  94.964,  39.647,  73.153, -84.705, -49.470, -54.911,  63.773, -15.249]])
prd = tensor_2d_to_prediction_batch(prd)
store_cprd(prd, '../test_files/test_utils.cprd')
